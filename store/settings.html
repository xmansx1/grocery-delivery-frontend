<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù„</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .settings-card {
        max-width: 600px;
        margin: 50px auto;
        background-color: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.html">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø­Ù„</a>
        <button class="btn btn-outline-light" onclick="logout()">
          ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
        </button>
      </div>
    </nav>

    <div class="settings-card">
      <h4 class="mb-4 text-center">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù„</h4>
      <form id="storeSettingsForm">
        <div class="mb-3">
          <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„</label>
          <input type="text" class="form-control" id="storeName" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
          <input type="tel" class="form-control" id="storePhone" disabled />
        </div>
        <div class="mb-3 form-check form-switch">
          <input class="form-check-input" type="checkbox" id="storeActive" />
          <label class="form-check-label" for="storeActive"
            >Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (ØªØ´ØºÙŠÙ„ / Ø¥ÙŠÙ‚Ø§Ù)</label
          >
        </div>
        <hr />
        <h6 class="mb-3">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h6>
        <div class="mb-3">
          <input
            type="password"
            class="form-control"
            placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©"
            id="newPassword"
          />
        </div>
        <div class="mb-3">
          <input
            type="password"
            class="form-control"
            placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
            id="confirmPassword"
          />
        </div>
        <button type="submit" class="btn btn-primary w-100">
          ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        </button>
      </form>
    </div>

    <script src="../assets/js/env.js"></script>
    <script>
      const token = localStorage.getItem("store_token");
      if (!token) window.location.href = "login.html";

      const storeNameInput = document.getElementById("storeName");
      const storePhoneInput = document.getElementById("storePhone");
      const storeActiveInput = document.getElementById("storeActive");

      async function loadStoreInfo() {
        try {
          const res = await fetch(`${API_BASE_URL}/store/profile`, {
            headers: { Authorization: "Bearer " + token },
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.detail || "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

          storeNameInput.value = data.name;
          storePhoneInput.value = data.phone;
          storeActiveInput.checked = data.is_active;
        } catch (err) {
          alert(err.message);
        }
      }

      document
        .getElementById("storeSettingsForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const name = storeNameInput.value;
          const is_active = storeActiveInput.checked;
          const newPassword = document.getElementById("newPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;

          if (newPassword && newPassword !== confirmPassword) {
            alert("âŒ ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚");
            return;
          }

          try {
            const res = await fetch(`${API_BASE_URL}/store/update`, {
              method: "POST",
              headers: {
                Authorization: "Bearer " + token,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                name,
                is_active,
                password: newPassword || null,
              }),
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.detail || "ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«");

            alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
            document.getElementById("newPassword").value = "";
            document.getElementById("confirmPassword").value = "";
          } catch (err) {
            alert(err.message);
          }
        });

      function logout() {
        localStorage.clear(); // âœ… ÙŠÙ…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù„Ø£ÙŠ Ù†ÙˆØ¹ Ø­Ø³Ø§Ø¨
        window.location.href = "/login.html"; // âœ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©
      }

      loadStoreInfo();
    </script>
  </body>
</html>
